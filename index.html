<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Zenith | Elite Focus</title>
    
    <link rel="manifest" href="manifest.json">
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js');
      }
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@900&family=Plus+Jakarta+Sans:wght@400;800&display=swap');
        
        :root { --accent: #881337; --bg: #fff1f2; }
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: var(--bg); color: var(--accent); 
            height: 100dvh; margin: 0; display: flex; flex-direction: column; overflow: hidden;
        }

        .zenith-stage {
            width: 100%; max-width: 800px; margin: 0 auto;
            height: 100%; display: flex; flex-direction: column;
            position: relative; padding: 0 2rem;
        }

        #floating-quote {
            position: absolute; width: 100%; top: 40%; left: 0; text-align: center;
            font-family: 'Outfit', sans-serif; font-weight: 900;
            font-size: clamp(3rem, 10vw, 6rem); text-transform: uppercase;
            opacity: 0; transition: all 1.2s ease-in-out; pointer-events: none; z-index: 0;
            color: rgba(136, 19, 55, 0.06);
        }

        .timer-font { 
            font-family: 'Outfit', sans-serif; 
            font-size: clamp(8rem, 20vw, 13rem); 
            font-weight: 900; line-height: 0.9; z-index: 10; 
            margin: 1rem 0;
        }

        .pill-button {
            background: black; color: white; padding: 10px 20px; border-radius: 50px;
            display: flex; align-items: center; gap: 10px; box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        #audio-mode { background: transparent; color: white; font-weight: 900; font-size: 11px; outline: none; border: none; cursor: pointer; }

        #reflection-screen {
            position: fixed; inset: 0; background: #000; color: white;
            z-index: 200; display: none; flex-direction: column; align-items: center; justify-content: center;
            padding: 2rem; text-align: center;
        }

        .full-overlay {
            position: fixed; inset: 0; background: white; z-index: 100;
            transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; flex-direction: column;
        }
        .full-overlay.active { transform: translateY(0); }
    </style>
</head>
<body>

    <div id="floating-quote">STAY LYNX</div>

    <div class="zenith-stage">
        <header class="py-8 flex justify-between items-start z-20">
            <div class="flex flex-col gap-3">
                <button onclick="toggleVault(true)" class="pill-button group">
                    <i data-lucide="database" class="w-4 h-4 text-rose-500"></i>
                    <span class="text-[10px] tracking-widest font-black uppercase">Vault</span>
                </button>
                <div id="streak-display" class="bg-rose-100 text-rose-900 px-4 py-2 rounded-full font-black text-[10px] flex items-center gap-2 self-start shadow-sm">
                    <i data-lucide="flame" class="w-3.5 h-3.5"></i> <span id="streak-count">0</span> DAY STREAK
                </div>
            </div>

            <div class="pill-button">
                <select id="audio-mode">
                    <option value="tick">TICK-TOCK</option>
                    <option value="rain">RAINSCAPE</option>
                    <option value="silent">SILENT</option>
                </select>
                <div class="h-4 w-[1px] bg-white/20 mx-1"></div>
                <input type="number" id="set-time" value="25" class="bg-transparent text-white w-8 font-black outline-none text-center text-sm border-b border-rose-500">
                <button onclick="applyTime()" class="bg-rose-600 text-[9px] font-black px-4 py-1.5 rounded-full text-white uppercase">Set</button>
            </div>
        </header>

        <main class="flex-grow flex flex-col items-center justify-center text-center pb-20">
            <div class="w-full max-w-md mb-2 z-10">
                <p class="text-[10px] font-black opacity-30 uppercase tracking-[0.4em] mb-3">Intent</p>
                <input type="text" id="focus-note" placeholder="WHAT ARE YOU CONQUERING?" class="w-full text-center text-2xl md:text-3xl font-black bg-transparent border-b-2 border-rose-200 focus:border-rose-900 outline-none pb-2 uppercase tracking-tighter">
            </div>

            <div id="timer-display" class="timer-font">25:00</div>

            <button id="start-btn" onclick="startFocus()" class="mt-8 w-full max-w-sm py-7 bg-black text-white rounded-[2.5rem] font-black text-xl shadow-2xl transition-all active:scale-95 z-20">
                START FOCUS
            </button>
        </main>
    </div>

    <div id="reflection-screen">
        <div class="text-rose-500 mb-6"><i data-lucide="zap" class="w-20 h-20 mx-auto"></i></div>
        <h1 class="text-4xl font-black uppercase mb-2">Goal Smashed</h1>
        <div class="w-full max-w-sm">
            <input type="text" id="journal-input" placeholder="What did you achieve?" class="w-full bg-transparent border-b-2 border-rose-500 outline-none text-white text-2xl text-center pb-4 mb-12 uppercase font-black">
            <button onclick="saveAchievement()" class="w-full bg-rose-600 text-white py-6 rounded-3xl font-black text-lg uppercase tracking-widest">
                Save to Vault
            </button>
        </div>
    </div>

    <div id="vault-overlay" class="full-overlay">
        <header class="p-8 flex justify-between items-center border-b">
            <h2 class="font-black text-sm uppercase">Achievement Intelligence</h2>
            <button onclick="toggleVault(false)" class="p-3 bg-rose-50 rounded-2xl"><i data-lucide="x"></i></button>
        </header>
        <div class="p-8 overflow-y-auto flex-grow max-w-3xl mx-auto w-full">
            <div class="mb-12 h-48"><canvas id="focusChart"></canvas></div>
            <div id="vault-list" class="space-y-4"></div>
        </div>
    </div>

    <script>
        let timeLeft = 1500; let timerId, quoteId, myChart;
        
        const tick = new Audio('https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3');
        const tock = new Audio('https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3');
        const rain = new Audio('https://www.soundjay.com/nature/sounds/rain-03.mp3');
        const fanfare = new Audio('https://www.soundjay.com/misc/sounds/success-fanfare-trumpets-1.mp3');
        rain.loop = true;

        function applyTime() { timeLeft = document.getElementById('set-time').value * 60; updateUI(); }
        function updateUI() {
            const m = Math.floor(timeLeft / 60); const s = timeLeft % 60;
            document.getElementById('timer-display').innerText = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function startFocus() {
            if(!document.getElementById('focus-note').value.trim()) return alert("Intent required.");
            
            tick.play().then(() => tick.pause());
            rain.play().then(() => rain.pause());
            
            applyTime();
            document.getElementById('start-btn').disabled = true;
            document.getElementById('start-btn').innerText = "LOCK-IN ACTIVE";
            
            const mode = document.getElementById('audio-mode').value;
            if(mode === 'rain') { rain.currentTime = 0; rain.play(); }

            timerId = setInterval(() => {
                if(timeLeft > 0) {
                    timeLeft--; updateUI();
                    if(mode === 'tick') { 
                        if(timeLeft % 2 === 0) { tick.currentTime = 0; tick.play(); } 
                        else { tock.currentTime = 0; tock.play(); } 
                    }
                } else { rain.pause(); showSaveScreen(); }
            }, 1000);
            moveQuotes(); quoteId = setInterval(moveQuotes, 12000);
        }

        function moveQuotes() {
            const q = document.getElementById('floating-quote');
            q.style.opacity = 0;
            setTimeout(() => {
                q.innerText = ["BEYOND LIMITS", "STAY LYNX", "DEEP WORK", "UNSTOPPABLE"][Math.floor(Math.random()*4)];
                q.style.top = (Math.random() * 20 + 40) + "%"; q.style.opacity = 0.08;
            }, 1000);
        }

        function showSaveScreen() {
            clearInterval(timerId); clearInterval(quoteId);
            fanfare.play();
            document.getElementById('reflection-screen').style.display = 'flex';
        }

        function saveAchievement() {
            const history = JSON.parse(localStorage.getItem('zenith_final_v1') || '[]');
            history.unshift({
                intent: document.getElementById('focus-note').value,
                summary: document.getElementById('journal-input').value || "Mission Complete.",
                duration: document.getElementById('set-time').value,
                date: new Date().toLocaleDateString(),
                time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})
            });
            localStorage.setItem('zenith_final_v1', JSON.stringify(history));
            location.reload();
        }

        function toggleVault(show) {
            const overlay = document.getElementById('vault-overlay');
            if(show) { renderVault(); overlay.classList.add('active'); }
            else overlay.classList.remove('active');
        }

        function renderVault() {
            const data = JSON.parse(localStorage.getItem('zenith_final_v1') || '[]');
            const list = document.getElementById('vault-list');
            list.innerHTML = data.map(i => `<div class="bg-rose-50 p-6 rounded-3xl"><b>${i.intent}</b><p>"${i.summary}"</p></div>`).join('');
            
            const ctx = document.getElementById('focusChart').getContext('2d');
            if(myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'bar', data: { labels: ['SESSIONS'], datasets: [{ data: [data.length], backgroundColor: '#881337' }] },
                options: { maintainAspectRatio: false }
            });
            lucide.createIcons();
        }

        window.onload = () => {
            const s = localStorage.getItem('zenith_streak_v1') || 0;
            document.getElementById('streak-count').innerText = s;
            lucide.createIcons();
        };
    </script>
</body>
</html>